{"version":3,"sources":["../../../src/components/radio/AudioPlayer.jsx"],"names":["A","reducer","DF_TITLE","MSG_NO_STATION","CL","PLAYER","S","TITLE_CONT","display","alignItems","_setMediaMetadata","artist","HAS","MEDIA_SESSION","navigator","mediaSession","metadata","MediaMetadata","title","_clearTimeout","ref","clearTimeout","current","PAUSE_TIMEOUT_MLS","initialState","msgErr","isUnloaded","isPlaying","volume","sound","INIT_VOLUME","AudioPlayer","_refPauseID","AppContext","uiThemeImpl","sApp","useSelector","uiTheme","station","currentStation","state","dispatch","_setVolume","newVolume","type","SET_VOLUME","setVolume","_increaseVolume","increaseVolume","_decreaseVolume","decreaseVolume","play","SET_PLAYING","SET_TITLE","pause","stop","setTimeout","UNLOAD","PAUSE","_unload","unload","STOP","_onError","msg","SET_ERROR","setActionHandler","src","init","bind","SET_LOADING","_style","toBg"],"mappings":"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","sourcesContent":["import { useRef, useReducer, useEffect, useCallback, useContext } from 'react'\r\n\r\nimport HAS from '../has'\r\nimport AppContext from '../AppContext'\r\n\r\nimport sound from '../../sound/sound'\r\nimport Radio from './Radio'\r\nimport Title from './Title'\r\nimport Equalizer from './Equalizer'\r\n\r\nimport reducer from './playerReducer'\r\n\r\nconst A = reducer.A;\r\n\r\nconst DF_TITLE = 'Radio Player v0.2.0'\r\nconst MSG_NO_STATION = 'At first, please, choose a radio station.'\r\n\r\nconst CL = {\r\n  PLAYER: 'audio-player'\r\n};\r\n\r\nconst S = {\r\n  TITLE_CONT: {\r\n    display: 'flex',\r\n    alignItems: 'center'\r\n  }\r\n};\r\n\r\n/*\r\nconst _setPlaybackState = (state) => {\r\n  if (HAS.MEDIA_SESSION) {\r\n    navigator.mediaSession.playbackState = state\r\n  }\r\n}\r\nconst _setPlaybackPlaying = _setPlaybackState.bind(null, 'playing')\r\nconst _setPlaybackPaused = _setPlaybackState.bind(null, 'paused')\r\nconst _setPlaybackNone = _setPlaybackState.bind(null, 'none')\r\n*/\r\n\r\nconst _setMediaMetadata = (artist='') => {\r\n  if (HAS.MEDIA_SESSION) {\r\n    /*\r\n    if (!artist || artist === DF_TITLE) {\r\n      _setPlaybackNone()\r\n    } else {\r\n      _setPlaybackPlaying()\r\n    }\r\n    */\r\n    /*eslint-disable no-undef*/\r\n    navigator.mediaSession.metadata = new MediaMetadata({\r\n      title: DF_TITLE,\r\n      artist\r\n    });\r\n    /*eslint-enable no-undef*/\r\n  }\r\n};\r\n\r\n/*\r\nconst _setMediaSessionHandlers = (onPlay=null, onPause=null) => {\r\n  const _mediaSession = navigator.mediaSession;\r\n  _mediaSession.setActionHandler('play', onPlay)\r\n  _mediaSession.setActionHandler('pause', onPause)\r\n  if (onPlay) {\r\n    _mediaSession.playbackState ='paused'\r\n  } else if (onPause) {\r\n    _mediaSession.playbackState = 'playing'\r\n  } else {\r\n    _mediaSession.playbackState = 'none'\r\n  }\r\n};\r\n*/\r\n\r\nconst _clearTimeout = ref => {\r\n  clearTimeout(ref.current)\r\n  ref.current = void 0;\r\n};\r\n\r\nconst PAUSE_TIMEOUT_MLS = 1000*60*3;\r\n\r\nconst initialState = {\r\n  msgErr: '',\r\n  title: DF_TITLE,\r\n  isUnloaded: true,\r\n  isPlaying: false,\r\n  volume: sound.INIT_VOLUME\r\n};\r\n\r\nconst AudioPlayer = () => {\r\n  const _refPauseID = useRef()\r\n  , {\r\n    uiThemeImpl,\r\n    sApp, useSelector\r\n  } = useContext(AppContext)\r\n  , uiTheme = useSelector(sApp.uiTheme)\r\n  , station = useSelector(sApp.currentStation)\r\n  , [state, dispatch] = useReducer(reducer, initialState)\r\n  , { isUnloaded, isPlaying,\r\n      volume,\r\n      title, msgErr\r\n    } = state;\r\n\r\n  const _setVolume = useCallback(newVolume => dispatch({\r\n    type: A.SET_VOLUME,\r\n    volume: sound.setVolume(newVolume)\r\n  }), []);\r\n  const _increaseVolume = useCallback(() => dispatch({\r\n    type: A.SET_VOLUME,\r\n    volume: sound.increaseVolume(0.01)\r\n  }), []);\r\n  const _decreaseVolume = useCallback(() => dispatch({\r\n    type: A.SET_VOLUME,\r\n    volume: sound.decreaseVolume(0.01)\r\n  }), []);\r\n\r\n  const play = () => {\r\n    _clearTimeout(_refPauseID)\r\n    if (!msgErr && sound.play()) {\r\n      dispatch({ type: A.SET_PLAYING })\r\n      _setMediaMetadata(station && station.title || DF_TITLE)\r\n      //_setMediaSessionHandlers(null, pause)\r\n    } else {\r\n      dispatch({ type: A.SET_TITLE, title: MSG_NO_STATION })\r\n      _setMediaMetadata()\r\n      //_setMediaSessionHandlers()\r\n    }\r\n  };\r\n  const pause = () => {\r\n    sound.stop()\r\n    //_setMediaSessionHandlers(play)\r\n    //_setPlaybackPaused()\r\n    _refPauseID.current = setTimeout(\r\n       () => dispatch({ type: A.UNLOAD }),\r\n       PAUSE_TIMEOUT_MLS\r\n    )\r\n    dispatch({ type: A.PAUSE })\r\n  };\r\n\r\n  const _unload = () => {\r\n    sound.unload()\r\n    dispatch({ type: A.UNLOAD })\r\n    //_setMediaSessionHandlers()\r\n    _setMediaMetadata()\r\n  };\r\n\r\n  const stop = useCallback(() => {\r\n    sound.stop()\r\n    sound.unload()\r\n    dispatch({ type: A.STOP })\r\n  }, [])\r\n\r\n  const _onError = (msg) => {\r\n    dispatch({ type: A.SET_ERROR, msgErr: msg })\r\n    _setMediaMetadata()\r\n  };\r\n\r\n  useEffect( () => {\r\n    if (HAS.MEDIA_SESSION) {\r\n      navigator.mediaSession.setActionHandler('pause', stop)\r\n    }\r\n  }, [])\r\n\r\n  useEffect(()=>{\r\n    if (station && station.src\r\n      && sound.init(station.src,\r\n          _onError.bind(null, 'Load Error'),\r\n          _onError.bind(null, 'Play Error'),\r\n      )) {\r\n        dispatch({ type: A.SET_LOADING })\r\n    }\r\n    return () => { sound.unload() };\r\n  }, [station])\r\n\r\n  const _style = uiThemeImpl.toBg(uiTheme);\r\n\r\n  return (\r\n    <div className={CL.PLAYER} style={_style}>\r\n      <Radio.Volume\r\n        volume={volume}\r\n        setVolume={_setVolume}\r\n        onIncrease={_increaseVolume}\r\n        onDecrease={_decreaseVolume}\r\n      />\r\n      <div style={S.TITLE_CONT}>\r\n        <Radio.Command\r\n          isPlaying={isPlaying}\r\n          onPlay={play}\r\n          onPause={pause}\r\n        />\r\n        <Title\r\n          station={station}\r\n          msgErr={msgErr}\r\n          title={title}\r\n        />\r\n        <Equalizer\r\n          isPlaying={isPlaying}\r\n          isUnloaded={isUnloaded}\r\n          unload={_unload}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default AudioPlayer\r\n"],"file":"AudioPlayer.js"}