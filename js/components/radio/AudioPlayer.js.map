{"version":3,"sources":["../../../src/components/radio/AudioPlayer.jsx"],"names":["A","reducer","DF_TITLE","MSG_NO_STATION","CL","PLAYER","S","TITLE_CONT","display","alignItems","_setMediaMetadata","artist","HAS","MEDIA_SESSION","navigator","mediaSession","metadata","MediaMetadata","title","initialState","msgErr","isUnloaded","isPlaying","volume","sound","INIT_VOLUME","AudioPlayer","station","AppContext","uiThemeImpl","sApp","uiTheme","state","dispatch","_setVolume","newVolume","type","SET_VOLUME","setVolume","_increaseVolume","increaseVolume","_decreaseVolume","decreaseVolume","play","SET_PLAYING","SET_TITLE","pause","stop","PAUSE","_unload","unload","UNLOAD","STOP","_onError","msg","SET_ERROR","setActionHandler","src","init","bind","SET_LOADING","_style","toBg"],"mappings":"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","sourcesContent":["import React, { useReducer, useEffect, useCallback, useContext } from 'react'\r\n\r\nimport { useSelector } from 'react-redux';\r\n\r\nimport HAS from '../has'\r\nimport AppContext from '../AppContext'\r\n\r\nimport sound from '../../sound/sound'\r\nimport Radio from './Radio'\r\nimport Title from './Title'\r\nimport Equalizer from './Equalizer'\r\n\r\nimport reducer from './playerReducer'\r\n\r\nconst A = reducer.A;\r\n\r\nconst DF_TITLE = 'Radio Player v0.1.0'\r\nconst MSG_NO_STATION = 'At first, please, choose a radio station.'\r\n\r\nconst CL = {\r\n  PLAYER: 'audio-player'\r\n};\r\n\r\nconst S = {\r\n  TITLE_CONT: {\r\n    display: 'flex',\r\n    alignItems: 'center'\r\n  }\r\n};\r\n\r\n/*\r\nconst _setPlaybackState = (state) => {\r\n  if (HAS.MEDIA_SESSION) {\r\n    navigator.mediaSession.playbackState = state\r\n  }\r\n}\r\nconst _setPlaybackPlaying = _setPlaybackState.bind(null, 'playing')\r\nconst _setPlaybackPaused = _setPlaybackState.bind(null, 'paused')\r\nconst _setPlaybackNone = _setPlaybackState.bind(null, 'none')\r\n*/\r\n\r\nconst _setMediaMetadata = (artist='') => {\r\n  if (HAS.MEDIA_SESSION) {\r\n    /*\r\n    if (!artist || artist === DF_TITLE) {\r\n      _setPlaybackNone()\r\n    } else {\r\n      _setPlaybackPlaying()\r\n    }\r\n    */\r\n    /*eslint-disable no-undef*/\r\n    navigator.mediaSession.metadata = new MediaMetadata({\r\n      title: DF_TITLE,\r\n      artist\r\n    });\r\n    /*eslint-enable no-undef*/\r\n  }\r\n};\r\n\r\n/*\r\nconst _setMediaSessionHandlers = (onPlay=null, onPause=null) => {\r\n  const _mediaSession = navigator.mediaSession;\r\n  _mediaSession.setActionHandler('play', onPlay)\r\n  _mediaSession.setActionHandler('pause', onPause)\r\n  if (onPlay) {\r\n    _mediaSession.playbackState ='paused'\r\n  } else if (onPause) {\r\n    _mediaSession.playbackState = 'playing'\r\n  } else {\r\n    _mediaSession.playbackState = 'none'\r\n  }\r\n};\r\n*/\r\n\r\nconst initialState = {\r\n  msgErr: '',\r\n  title: DF_TITLE,\r\n  isUnloaded: true,\r\n  isPlaying: false,\r\n  volume: sound.INIT_VOLUME\r\n};\r\n\r\nconst AudioPlayer = ({ station }) => {\r\n  const { uiThemeImpl, sApp } = useContext(AppContext)\r\n  const uiTheme = useSelector(sApp.uiTheme)\r\n  , [state, dispatch] = useReducer(reducer, initialState)\r\n  , { isUnloaded, isPlaying,\r\n      volume,\r\n      title, msgErr\r\n    } = state;\r\n\r\n  const _setVolume = useCallback(newVolume => dispatch({\r\n    type: A.SET_VOLUME,\r\n    volume: sound.setVolume(newVolume)\r\n  }), []);\r\n  const _increaseVolume = useCallback(() => dispatch({\r\n    type: A.SET_VOLUME,\r\n    volume: sound.increaseVolume(0.01)\r\n  }), []);\r\n  const _decreaseVolume = useCallback(() => dispatch({\r\n    type: A.SET_VOLUME,\r\n    volume: sound.decreaseVolume(0.01)\r\n  }), []);\r\n\r\n  const play = () => {\r\n    if (!msgErr && sound.play()) {\r\n      dispatch({ type: A.SET_PLAYING })\r\n      _setMediaMetadata(station && station.title || DF_TITLE)\r\n      //_setMediaSessionHandlers(null, pause)\r\n    } else {\r\n      dispatch({ type: A.SET_TITLE, title: MSG_NO_STATION })\r\n      _setMediaMetadata()\r\n      //_setMediaSessionHandlers()\r\n    }\r\n  };\r\n  const pause = () => {\r\n    sound.stop()\r\n    //_setMediaSessionHandlers(play)\r\n    //_setPlaybackPaused()\r\n    dispatch({ type: A.PAUSE })\r\n  };\r\n\r\n  const _unload = () => {\r\n    sound.unload()\r\n    dispatch({ type: A.UNLOAD })\r\n    //_setMediaSessionHandlers()\r\n    _setMediaMetadata()\r\n  };\r\n\r\n  const stop = useCallback(() => {\r\n    sound.stop()\r\n    sound.unload()\r\n    dispatch({ type: A.STOP })\r\n  }, [])\r\n\r\n  const _onError = (msg) => {\r\n    dispatch({ type: A.SET_ERROR, msgErr: msg })\r\n    _setMediaMetadata()\r\n  };\r\n\r\n  useEffect( () => {\r\n    if (HAS.MEDIA_SESSION) {\r\n      navigator.mediaSession.setActionHandler('pause', stop)\r\n    }\r\n  }, [])\r\n\r\n  /*\r\n  useEffect( () => {\r\n    if (HAS.MEDIA_SESSION) {\r\n      const _mediaSession = navigator.mediaSession;\r\n      _mediaSession.setActionHandler('play', play)\r\n      _mediaSession.setActionHandler('pause', pause)\r\n    }\r\n  }, [])\r\n  */\r\n\r\n  useEffect(()=>{\r\n    if (station && station.src\r\n      && sound.init(station.src,\r\n          _onError.bind(null, 'Load Error'),\r\n          _onError.bind(null, 'Play Error'),\r\n      )) {\r\n        dispatch({ type: A.SET_LOADING })\r\n    }\r\n    return () => { sound.unload() };\r\n  }, [station])\r\n\r\n  const _style = uiThemeImpl.toBg(uiTheme);\r\n\r\n  return (\r\n    <div className={CL.PLAYER} style={_style}>\r\n      <Radio.Volume\r\n        volume={volume}\r\n        setVolume={_setVolume}\r\n        onIncrease={_increaseVolume}\r\n        onDecrease={_decreaseVolume}\r\n      />\r\n      <div style={S.TITLE_CONT}>\r\n        <Radio.Command\r\n          isPlaying={isPlaying}\r\n          onPlay={play}\r\n          onPause={pause}\r\n        />\r\n        <Title\r\n          station={station}\r\n          msgErr={msgErr}\r\n          title={title}\r\n        />\r\n        <Equalizer\r\n          isPlaying={isPlaying}\r\n          isUnloaded={isUnloaded}\r\n          unload={_unload}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default AudioPlayer\r\n"],"file":"AudioPlayer.js"}